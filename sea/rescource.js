/**
 * Created by taohan on 16/6/1.
 */
//资源项
var res_sea={
    "particle":"res/particle.plist",
    "particle1":"res/particle2.plist",
    "particle2":"res/particle3.plist",
    //最底层0
    "bg_1":"res/bg_lay/bg_deepwater@2x.png",
    "balloon1":"res/bg_lay/bg_icon_balloon_red@2x.png",
    "balloon2":"res/bg_lay/bg_icon_balloon_yellow@2x.png",
    "cloud1":"res/bg_lay/bg_icon_cloud1@2x.png",
    "cloud2":"res/bg_lay/bg_icon_cloud2@2x.png",
    "cloud3":"res/bg_lay/bg_icon_cloud3@2x.png",
    "cloud4":"res/bg_lay/bg_icon_cloud4@2x.png",
    "cloud5":"res/bg_lay/bg_icon_cloud5@2x.png",
    "cloud6":"res/bg_lay/bg_icon_cloud6@2x.png",
    "island":"res/bg_lay/bg_icon_island@2x.png",
    "big_ship":"res/bg_lay/bg_icon_steamship_big@2x.png",
    "small_ship":"res/bg_lay/bg_icon_steamship_small@2x.png",
    "volcano":"res/bg_lay/bg_icon_volcano@2x.png",
    "lowest":"res/bg_lay/bg_the_lowest_level@2x.png",
    "begin_json":"res/spine/begin/begin.json",
    "begin_atlas":"res/spine/begin/begin.atlas",
    "begin_png":"res/spine/begin/begin.png",
    "spine0.1_json":"res/spine/volcano/valcano.json",
    "spine0.1_atlas":"res/spine/volcano/valcano.atlas",
    "spine0.1_png":"res/spine/volcano/valcano.png",
    //1
    "water":"res/lay3/sea_bg_water3@2x.png",
    "sea_bed1":"res/bg_lay/bg_icon_seabed1@2x.png",
    "sea_bed2":"res/lay2/bg_icon_seabed2@2x.png",
    "cliff":"res/lay3/bg_icon_cliff@2x.png",
    "shark":"res/lay3/bg_an_shark@2x.png",
    "shoal_fish":"res/lay3/bg_icon_shoal_fish@2x.png",
    "shoal_one_fish":"res/lay3/bg_icon_shoal_of_fish@2x.png",
    "spine3.1_json":"res/spine/batfish/batfish.json",
    "spine3.1_atlas":"res/spine/batfish/batfish.atlas",
    "spine3.1_png":"res/spine/batfish/batfish.png",
    "spine3.2_json":"res/spine/fish_light/fish_fight.json",
    "spine3.2_atlas":"res/spine/fish_light/fish_fight.atlas",
    "spine3.2_png":"res/spine/fish_light/fish_fight.png",
    "spine3.3_json":"res/spine/jellyfish/jellyfish.json",
    "spine3.3_atlas":"res/spine/jellyfish/jellyfish.atlas",
    "spine3.3_png":"res/spine/jellyfish/jellyfish.png",
    "spine3.4_json":"res/spine/octopus/octopus.json",
    "spine3.4_atlas":"res/spine/octopus/octopus.atlas",
    "spine3.4_png":"res/spine/octopus/octopus.png",
    "spine3.5_json":"res/spine/swim01/swim01.json",
    "spine3.5_atlas":"res/spine/swim01/swim01.atlas",
    "spine3.5_png":"res/spine/swim01/swim01.png",
    "spine3.6_json":"res/spine/swim02/swim02.json",
    "spine3.6_atlas":"res/spine/swim02/swim02.atlas",
    "spine3.6_png":"res/spine/swim02/swim02.png",
    "test_json":"res/spine/shark1/shark.json",
    "test_atlas":"res/spine/shark1/shark.atlas",
    "test_png":"res/spine/shark1/shark.png",
    //2
    "sea":"res/lay2/sea_bg_water2@2x.png",
    "inkfish":"res/lay2/bg_an_inkfish@2x.png",
    "bottom":"res/lay2/bg_an_sulphur_bottom@2x.png",
    "b1":"res/lay2/bg_icon_bottle1@2x.png",
    "b2":"res/lay2/bg_icon_bottle2@2x.png",
    "spine2.1_json":"res/spine/lantern/lantern_fish.json",
    "spine2.1_atlas":"res/spine/lantern/lantern_fish.atlas",
    "spine2.1_png":"res/spine/lantern/lantern_fish.png",
    "spine2.2_json":"res/spine/sea_horse/sea_horse.json",
    "spine2.2_atlas":"res/spine/sea_horse/sea_horse.atlas",
    "spine2.2_png":"res/spine/sea_horse/sea_horse.png",
    //3
    "pic1.1":"res/lay1/bg_an_actinian_purple@2x.png",
    "pic1.2":"res/lay1/bg_an_actinian_yellow@2x.png",
    "pic1.3":"res/lay1/bg_an_blue_fish@2x.png",
    "pic1.4":"res/lay1/bg_an_butterflyfishes@2x.png",
    "pic1.5":"res/lay1/bg_an_cowry1@2x.png",
    "pic1.6":"res/lay1/bg_an_cowry@2x.png",
    "pic1.7":"res/lay1/bg_an_fish_blue1@2x.png",
    "pic1.8":"res/lay1/bg_an_fish_yellow1@2x.png",
    "pic1.9":"res/lay1/bg_an_plankton1@2x.png",
    "pic1.10":"res/lay1/bg_an_plankton@2x.png",
    "pic1.11":"res/lay1/bg_an_spotlight@2x.png",
    "pic1.12":"res/lay1/bg_an_starfish_green@2x.png",
    "pic1.13":"res/lay1/bg_an_starfish_red@2x.png",
    "pic1.14":"res/lay1/bg_an_starfish_yellow@2x.png",
    "pic1.15":"res/lay1/bg_an_yellow_fish@2x.png",
    "pic1.16":"res/lay1/bg_icon_aquarium@2x.png",
    "pic1.17":"res/lay1/bg_icon_box@2x.png",
    "pic1.18":"res/lay1/bg_icon_corall2@2x.png",
    "pic1.19":"res/lay1/bg_icon_corall@2x.png",
    "pic1.20":"res/lay1/bg_icon_corall_big1@2x.png",
    "pic1.21":"res/lay1/bg_icon_corall_red1@2x.png",
    "pic1.22":"res/lay1/bg_icon_corall_red@2x.png",
    "pic1.23":"res/lay1/bg_icon_corall_round@2x.png",
    "pic1.24":"res/lay1/bg_icon_corall_round_small@2x.png",
    "pic1.25":"res/lay1/bg_icon_corall_tree_red@2x.png",
    "pic1.26":"res/lay1/bg_icon_grass1@2x.png",
    "pic1.27":"res/lay1/bg_icon_grass2@2x.png",
    "pic1.28":"res/lay1/bg_icon_grass3@2x.png",
    "pic1.29":"res/lay1/bg_icon_grass4@2x.png",
    "pic1.30":"res/lay1/bg_icon_grass5@2x.png",
    "pic1.33":"res/lay1/bg_icon_rock1@2x.png",
    "pic1.34":"res/lay1/bg_icon_rock@2x.png",
    "pic1.35":"res/lay1/bg_icon_stone@2x.png",
    "pic1.36":"res/lay1/bg_icon_submarine@2x.png",
    "pic1.37":"res/lay1/sea_bg_water1@2x.png",
    "pic1.38":"res/lay1/sea_bg_water_bed@2x.png",
    "spine1.1_json":"res/spine/anemone_purple/sea_purple.json",
    "spine1.1_atlas":"res/spine/anemone_purple/sea_purple.atlas",
    "spine1.1_png":"res/spine/anemone_purple/sea_purple.png",
    "spine1.2_json":"res/spine/anemone_yellow/sea_yellow.json",
    "spine1.2_atlas":"res/spine/anemone_yellow/sea_yellow.atlas",
    "spine1.2_png":"res/spine/anemone_yellow/sea_yellow.png",
    "spine1.3_json":"res/spine/coral01/coral1_big.json",
    "spine1.3_atlas":"res/spine/coral01/coral1_big.atlas",
    "spine1.3_png":"res/spine/coral01/coral1_big.png",
    "spine1.4_json":"res/spine/coral02/coral2.json",
    "spine1.4_atlas":"res/spine/coral02/coral2.atlas",
    "spine1.4_png":"res/spine/coral02/coral2.png",
    "spine1.5_json":"res/spine/coral03/coral3.json",
    "spine1.5_atlas":"res/spine/coral03/coral3.atlas",
    "spine1.5_png":"res/spine/coral03/coral3.png",
    "spine1.7_json":"res/spine/cor/cor.json",
    "spine1.7_atlas":"res/spine/cor/cor.atlas",
    "spine1.7_png":"res/spine/cor/cor.png",
    "spine1.8_json":"res/spine/sea_otter/seaotter.json",
    "spine1.8_atlas":"res/spine/sea_otter/seaotter.atlas",
    "spine1.8_png":"res/spine/sea_otter/seaotter.png",
    "spine1.9_json":"res/spine/shark/shark.json",
    "spine1.9_atlas":"res/spine/shark/shark.atlas",
    "spine1.9_png":"res/spine/shark/shark.png",
    "spine1.10_json":"res/spine/submarine/submarine.json",
    "spine1.10_atlas":"res/spine/submarine/submarine.atlas",
    "spine1.10_png":"res/spine/submarine/submarine.png",
    "spine1.11_json":"res/spine/whale/whale.json",
    "spine1.11_atlas":"res/spine/whale/whale.atlas",
    "spine1.11_png":"res/spine/whale/whale.png",
    "fish1_json":"res/spine/blue_fish/fish_blue2.json",
    "fish1_atlas":"res/spine/blue_fish/fish_blue2.atlas",
    "fish1_png":"res/spine/blue_fish/fish_blue2.png",
    "fish2_json":"res/spine/butterflyfishes/butterflyfishes.json",
    "fish2_atlas":"res/spine/butterflyfishes/butterflyfishes.atlas",
    "fish2_png":"res/spine/butterflyfishes/butterflyfishes.png",
    "fish3_json":"res/spine/fish_blue1/fish_blue1.json",
    "fish3_atlas":"res/spine/fish_blue1/fish_blue1.atlas",
    "fish3_png":"res/spine/fish_blue1/fish_blue1.png",
    "fish4_json":"res/spine/fish_yellow1/fish_yellow1.json",
    "fish4_atlas":"res/spine/fish_yellow1/fish_yellow1.atlas",
    "fish4_png":"res/spine/fish_yellow1/fish_yellow1.png",
    "fish5_json":"res/spine/yellow_fish/yellow_fish.json",
    "fish5_atlas":"res/spine/yellow_fish/yellow_fish.atlas",
    "fish5_png":"res/spine/yellow_fish/yellow_fish.png"
};
//创建海洋不同层面的函数 type代表是否为点击事物 i代表层，0-3，0是最下层
var create_sea=function(type,res,i,x,y){
    var sprite=new cc.Sprite(res);
    sprite.setAnchorPoint(0,0);
    sprite.setPosition(x,y);
    self.addChild(sprite,2+i);
    self.sprite_array[i].push(sprite);
    if(type==1){
        self.click_array.push(sprite);
    }
    return true;
};

//引用骨骼动画的函数 json atlas name x ，y,i(层次)，1（是否调用set_animation函数）
var useSpine=function(json,atlas,name,x,y,i,t){
    var spineBoy = new sp.SkeletonAnimation(json,atlas);
    spineBoy.setPosition(x, y);
    spineBoy.setAnimation(0, name, true);//trues时为一直循环播放
    spineBoy.setVisible(true);
    self.addChild(spineBoy,2+i);
    self.sprite_array[i].push(spineBoy);
    self.click_array.push(spineBoy);
    if(t==1){
        set_animation(spineBoy);
    }else if(t==2){
        set_animation1(spineBoy);
    }else if(t==3){
        set_animation2(spineBoy);
    }else if(t==4){
        set_animation3(spineBoy);
    }
};
//当前创建的这个精灵设置旋转 i代表层 v代表旋转值
var rotateby=function(i,v){
    self.sprite_array[i][self.sprite_array[i].length-1].runAction(cc.rotateTo(0,v));
    return true;
};
//小鱼随机移动8个方向
var fish_animation = {
    "t0": "cc.sequence(cc.scaleBy(0.1,0.1,1),cc.rotateTo(0, -90),cc.scaleBy(0.1,10,1),cc.moveBy(3, 0, 100))",
    "t1": "cc.sequence(cc.scaleBy(0.1,0.1,1),cc.rotateTo(0, -45),cc.scaleBy(0.1,10,1), cc.moveBy(3, 100, 100))",
    "t2": "cc.sequence(cc.scaleBy(0.1,0.1,1),cc.rotateTo(0, 0),cc.scaleBy(0.1,10,1), cc.moveBy(3, 100, 0))",
    "t3": "cc.sequence(cc.scaleBy(0.1,0.1,1),cc.rotateTo(0, 45),cc.scaleBy(0.1,10,1), cc.moveBy(3, 100, -100))",
    "t4": "cc.sequence(cc.scaleBy(0.1,0.1,1),cc.rotateTo(0, 90),cc.scaleBy(0.1,10,1), cc.moveBy(3, 0, -100))",
    "t5": "cc.sequence(cc.scaleBy(0.1,0.1,1),cc.rotateTo(0, 135),cc.scaleBy(0.1,10,1), cc.moveBy(3, -100, -100))",
    "t6": "cc.sequence(cc.scaleBy(0.1,0.1,1),cc.rotateTo(0, 180),cc.scaleBy(0.1,10,1), cc.moveBy(3, -100, 0))",
    "t7": "cc.sequence(cc.scaleBy(0.1,0.1,1),cc.rotateTo(0, 225),cc.scaleBy(0.1,10,1), cc.moveBy(3, -100, 100))"
};
//当前创建的这个精灵设置翻转 i代表层 1代表水平，0代表垂直翻转
var flipxy=function(i,v){
    if(v==1){
        self.sprite_array[i][self.sprite_array[i].length-1].rotationY=180;
    }else{
        self.sprite_array[i][self.sprite_array[i].length-1].rotationX=180;
    }
};
//一个鱼跑，另一个鱼追效果 sprite1跑 sprite2追
var func_one=function(sprite1,sprite2){
    self.choosed.push(sprite1);
    self.choosed.push(sprite2);
    self2=this;
    self2.tag=0;//是否被拖动
    self2.location_1_start=null;
    cc.eventManager.addListener({
        event: cc.EventListener.TOUCH_ONE_BY_ONE,
        onTouchBegan: function (touch) {
            var location=touch.getLocation();
            if(cc.rectContainsPoint(sprite1.getBoundingBox(),location)){
                self.move_or_swim=1;
               self2.location_1_start=sprite1.getPosition();
                self2.tag=1;
            }else{
                self2.tag=0;
            }
            return true;
        },
        onTouchMoved:function(touch) {
            var location = touch.getLocation();
            if(self2.tag!=0){
                sprite1.setPosition(location);
                sprite2.setPosition(location.x - 20, location.y + 20);
                if (location.y < 100 ) {//判定游到了下边缘
                    if (self.sprite_array[0][0].y < 0) {
                        for (var i = 0; i < self.sprite_array.length; i++) {
                            for (var j = 0; j < self.sprite_array[i].length; j++) {
                                if (self.sprite_array[i][j] != sprite1 && self.sprite_array[i][j] != sprite2) {
                                    var f=cc.moveBy(0.1, 0, 1).repeatForever();
                                    f.setTag(1);
                                    self.sprite_array[i][j].runAction(f);
                                    sprite1.setPosition(location);
                                    sprite2.setPosition(location.x - 20, location.y + 20);
                                }
                            }
                        }
                    }
                }else if(location.y > 500 ) {//判定游到了上边缘
                    if (self.sprite_array[0][0].y >-1151) {
                        for (var i = 0; i < self.sprite_array.length; i++) {
                            for (var j = 0; j < self.sprite_array[i].length; j++) {
                                if (self.sprite_array[i][j] != sprite1 && self.sprite_array[i][j] != sprite2) {
                                    var f=cc.moveBy(0.1, 0, -1).repeatForever();
                                    f.setTag(1);
                                    self.sprite_array[i][j].runAction(f);
                                    sprite1.setPosition(location);
                                    sprite2.setPosition(location.x - 20, location.y + 20);
                                }
                            }
                        }
                    }
                }
                //视角平移刹车
                if(location.y>100 && location.y<500 && location.x<1000 && location.x>100){
                    for (var i = 0; i < self.sprite_array.length; i++) {
                        for (var j = 0; j < self.sprite_array[i].length; j++) {
                            self.sprite_array[i][j].stopActionByTag(1);
                        }
                    }
                }
                if(location.x <100 ) {//判定游到了左边缘
                    if (self.sprite_array[0][0].x <0) {
                        for (var i = 0; i < self.sprite_array.length; i++) {
                            for (var j = 0; j < self.sprite_array[i].length; j++) {
                                if (self.sprite_array[i][j] != sprite1 && self.sprite_array[i][j] != sprite2) {
                                    var f=cc.moveBy(0.1, 1, 0).repeatForever();
                                    f.setTag(1);
                                    self.sprite_array[i][j].runAction(f);
                                    sprite1.setPosition(location);
                                    sprite2.setPosition(location.x - 20, location.y + 20);
                                }
                            }
                        }
                    }
                }else if(location.x >1000 ) {//判定游到了右边缘
                    if (self.sprite_array[0][0].x >-2054) {
                        for (var i = 0; i < self.sprite_array.length; i++) {
                            for (var j = 0; j < self.sprite_array[i].length; j++) {
                                if (self.sprite_array[i][j] != sprite1 && self.sprite_array[i][j] != sprite2) {
                                    var f=cc.moveBy(0.1, -1, 0).repeatForever();
                                    f.setTag(1);
                                    self.sprite_array[i][j].runAction(f);
                                    sprite1.setPosition(location);
                                    sprite2.setPosition(location.x - 20, location.y + 20);
                                }
                            }
                        }
                    }
                }

                self2.location_1_start = location;
                return true;
            }
        },
        onTouchEnded:function(touch){
            self2.tag=0;
            self.move_or_swim=0;//释放scrollView

            return true;
        }
    },self);
    return true;
};

//两个鸳鸯鱼效果函数 sprite1 sprite2
//follow效果不好 舍弃


//粒子效果
var add_particle=function(res,x,y,z,s){
    var par= new cc.ParticleSystem(res);
    par.setPosition(x, y);
    par.duration=3600;
    par.scale=s;
    self.addChild(par,z);
    self.sprite_array[4].push(par);
};

//各类鱼类的循环游动轨迹
//顺时针
var set_animation=function(res){
    res.runAction(cc.sequence(cc.rotateBy(0.5,-30),cc.moveBy(10,200,200),cc.rotateBy(0.5,30),cc.moveBy(20,700,0),cc.rotateBy(0.5,30),cc.moveBy(4,200,-200),cc.rotateBy(0.5,-30),cc.callFunc(function(){
        res.rotationY=180;
    }),cc.moveBy(30,-1100,0),cc.callFunc(function(){
        res.rotationY=0;
    })).repeatForever());

};
//向左水平
var set_animation1=function(res){
    res.runAction(cc.sequence(cc.moveBy(30,-500,0),cc.scaleBy(0,0.1,1),cc.callFunc(function(){
        res.rotationY=180;
    }),cc.scaleBy(0,10,1),cc.moveBy(30,500,0),cc.scaleBy(0,0.1,1),cc.callFunc(function(){
        res.rotationY=0;
    }),cc.scaleBy(0,10,1)).repeatForever());
};
//向右水平
var set_animation2=function(res){
    res.runAction(cc.sequence(cc.moveBy(30,500,0),cc.scaleBy(0,0.1,1),cc.callFunc(function(){
        res.rotationY=180;
    }),cc.scaleBy(0,10,1),cc.moveBy(30,-500,0),cc.scaleBy(0,0.1,1),cc.callFunc(function(){
        res.rotationY=0;
    }),cc.scaleBy(0,10,1)).repeatForever());
};
//浮游生物任意浮动
var set_animation3=function(res){
    var t=90+Math.random()*90;
    res.runAction(cc.sequence(cc.jumpBy(t,1000,-500,40,10),cc.jumpBy(t,-1000,500,40,10)).repeatForever());
};
//小鱼随机移动
var fish=function(res1,res2){
    self.schedule(function(){
        var t = "t"+parseInt(Math.random() * 7);
        //瓢虫动画
        res1.runAction(eval(fish_animation[t]));
        res2.runAction(eval(fish_animation[t]));
        return true;
    },3,80,0);
};
//水平循环移动 res，d，t
var horizon_move=function(res,d,t){
    if(d>0){
        res.runAction(cc.sequence(cc.moveBy(t,d,0),cc.callFunc(function(){
            res.x=-200;
        })).repeatForever());
    }else{
        res.runAction(cc.sequence(cc.moveBy(t,d,0),cc.callFunc(function(){
            res.x=2650;
        })).repeatForever());
    }
};
//特效，上下浮动，加倾斜i层 r旋转值
var float_act=function(i,r){
    self.sprite_array[i][self.sprite_array[i].length-1].rotate=r;
    self.sprite_array[i][self.sprite_array[i].length-1].runAction(cc.sequence(cc.rotateTo(0,r),cc.moveBy(1,0,20),cc.moveBy(1,0,-20)).repeatForever());
};

var g_resources_sea=[];
for (var i in res_sea) {
    g_resources_sea.push(res_sea[i]);
}
